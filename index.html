<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Graphs with Sample Table</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
  <style>
    body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 20px;
      height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    .plot {
      width: 100%;
      height: 100%;
    }
    #functionWrapper {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      width: 100%;
      height: 100%;
    }
    #leftSide {
      flex: 3;
      display: flex;
      flex-direction: column;
    }
    #function2D {
      flex: 1;
      width: 100%;
    }
    #controls {
      margin-top: 10px;
    }
    #rightSide {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-left: 15px;
    }
    button {
      margin: 5px 0;
      padding: 6px 12px;
      border-radius: 8px;
      border: none;
      background: #0077cc;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    #tableWrapper {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 10px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 10px;
      text-align: center;
    }
    th {
      background: #f0f0f0;
      position: sticky;
      top: 0;
    }
  </style>
</head>
<body>
  <div id="surfacePlot" class="plot"></div>
  <div id="vectorField" class="plot"></div>

  <!-- Function graph + table side by side -->
  <div id="functionWrapper">
    <div id="leftSide">
      <div id="function2D"></div>
      <div id="controls">
        <button id="resetBtn">Reset Points</button>
        <button id="randomBtn">Generate 6 Random Points</button>
      </div>
    </div>
    <div id="rightSide">
      <div id="tableWrapper">
        <table id="pointsTable">
          <thead>
            <tr><th>#</th><th>x</th><th>y</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    //---------------------------------
    // FUNCTIONS (customize these)
    //---------------------------------
    const f = math.parse("sin(sqrt(x^2 + y^2))").compile();
    const uExpr = math.parse("-y").compile();
    const vExpr = math.parse("x").compile();
    const g = math.parse("cos(x)").compile();

    //---------------------------------
    // 1. 3D Surface
    //---------------------------------
    let xValues = math.range(-5, 5.5, 0.5).toArray();
    let yValues = math.range(-5, 5.5, 0.5).toArray();
    let zValues = [];
    for (let i = 0; i < xValues.length; i++) {
      let row = [];
      for (let j = 0; j < yValues.length; j++) {
        row.push(f.evaluate({x: xValues[i], y: yValues[j]}));
      }
      zValues.push(row);
    }
    Plotly.newPlot("surfacePlot", [{
      type: "surface",
      x: xValues,
      y: yValues,
      z: zValues,
      colorscale: "Viridis"
    }], {title: "3D Surface f(x,y)"});

    //---------------------------------
    // 2. Vector Field
    //---------------------------------
    let X = [], Y = [], U = [], V = [];
    for (let i = -5; i <= 5; i++) {
      for (let j = -5; j <= 5; j++) {
        X.push(i); Y.push(j);
        U.push(uExpr.evaluate({x: i, y: j}));
        V.push(vExpr.evaluate({x: i, y: j}));
      }
    }
    let arrows = { type:"scatter", mode:"lines+markers", x:[], y:[], line:{width:2,color:"blue"}, marker:{size:2}};
    for (let k = 0; k < X.length; k++) {
      arrows.x.push(X[k], X[k] + U[k], null);
      arrows.y.push(Y[k], Y[k] + V[k], null);
    }
    Plotly.newPlot("vectorField", [arrows], {title:"Vector Field (u,v)", xaxis:{scaleanchor:"y"}, yaxis:{scaleanchor:"x"}});

//---------------------------------
// 3. Function + Sample Points
//---------------------------------

  // Pick a random function form
  const forms = ["ab^x", "ax^b", "a*ln(x)+b"];
  const chosen = forms[Math.floor(Math.random() * forms.length)];

  // Random coefficients
  const a = (Math.random() * 3 + 1).toFixed(2);  // between 1 and 4
  const b = (Math.random() * 3 + 1).toFixed(2);  // between 1 and 4

  let exprStr = chosen
    .replace("a", a)
    .replace("b", b);

  // Compile chosen function
  const g = math.parse(exprStr).compile();

  // Sample curve
  let xLine = math.range(1, 10, 0.1).toArray();
  let yLine = xLine.map(x => g.evaluate({x}));

  let funcTrace = {
    type: "scatter",
    mode: "lines",
    x: xLine,
    y: yLine,
    line: { color: "red" },
    name: `g(x) = ${exprStr}`
  };

  let pointsTrace = {
    type: "scatter",
    mode: "markers",
    x: [],
    y: [],
    marker: { color: "black", size: 8 },
    name: "Sample Points"
  };

  let layout2D = {
    title: `2D Function g(x) = ${exprStr}`,
    dragmode: false,
    xaxis: { range: [-2, 15] },
    yaxis: { range: [-2, 25] }
  };

  Plotly.newPlot("function2D", [funcTrace, pointsTrace], layout2D);

  let dataset = [];

  function updateTable() {
    const tbody = document.querySelector("#pointsTable tbody");
    tbody.innerHTML = "";
    dataset.forEach((pt, i) => {
      let row = document.createElement("tr");
      row.innerHTML = `<td>${i + 1}</td><td>${pt.x.toFixed(3)}</td><td>${pt.y.toFixed(3)}</td>`;
      tbody.appendChild(row);
    });
  }

  // Reset button
  document.getElementById("resetBtn").onclick = () => {
    dataset = [];
    pointsTrace.x = [];
    pointsTrace.y = [];
    Plotly.redraw("function2D");
    updateTable();
  };

  // Random button generates 6 points near curve
  document.getElementById("randomBtn").onclick = () => {
    dataset = [];
    pointsTrace.x = [];
    pointsTrace.y = [];

    for (let i = 0; i < 6; i++) {
      let x = Math.random() * 9 + 1; // between 1 and 10
      let trueY = g.evaluate({x});
      let err = (Math.random() - 0.5) * 0.5; // -0.25 to +0.25
      let y = trueY + err;
      dataset.push({ x, y });
      pointsTrace.x.push(x);
      pointsTrace.y.push(y);
    }

    Plotly.redraw("function2D");
    updateTable();
  };
</script>
</body>
</html>
